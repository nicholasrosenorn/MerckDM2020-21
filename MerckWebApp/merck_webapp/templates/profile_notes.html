{% extends "layout.html" %}
{% block content %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Patient Profile</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ygbV9kiqUc6oa4msXn9868pTtWMgiQaeYH7/t7LECLbyPA2x65Kgf80OJFdroafW"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"
        integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg=="
        crossorigin="anonymous"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='profile_style.css') }}">
</head>

<!-- Modal -->
{% macro render_modal(note) -%}
<div class="modal fade" id="viewModal{{note.input_date.date()}}" tabindex="-1"
    aria-labelledby="viewModalLabel{{note.input_date.date()}}" aria-hidden="true">
    <div class="modal-dialog modal-dialog-scrollable" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="esurveyModalTitle">
                    {{calendar.day_name[note.input_date.weekday()]}} -
                    {{note.input_date.day}}
                    {{calendar.month_name[note.input_date.month]}},
                    {{note.input_date.year}}</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form action="" method="POST">
                <div class="modal-body">
                    {{ form.hidden_tag() }}
                    <fieldset>
                        <div class="form-group">
                            {{
                            form.username.label(class="form-control-label")
                            }}

                            {% if form.username.errors %}
                            {{ form.username(class="form-control form-control-lg
                            is-invalid") }}
                            <div class="invalid-feedback">
                                {% for error in form.username.errors %}
                                <span>{{ error }}</span>
                                {% endfor %}
                            </div>
                            {% else %}
                            {{ form.username(class="form-control form-control-lg",
                            placeholder=note.username) }}
                            {% endif %}
                        </div>
                        <div class="form-group">
                            {{ form.input_date.label(class="form-control-label") }}

                            {% if form.input_date.errors %}
                            {{ form.input_date(class="form-control form-control-lg
                            is-invalid")
                            }}
                            <div class="invalid-feedback">
                                {% for error in form.input_date.errors %}
                                <span>{{ error }}</span>
                                {% endfor %}
                            </div>
                            {% else %}
                            {{ form.input_date(class="form-control form-control-lg",
                            placeholder=note.input_date.date()) }}
                            {% endif %}
                        </div>
                        <div class="form-group">
                            {{ form.family_history.label(class="form-control-label") }}

                            {% if form.family_history.errors %}
                            {{ form.family_history(class="form-control form-control-lg
                            is-invalid") }}
                            <div class="invalid-feedback">
                                {% for error in form.family_history.errors %}
                                <span>{{ error }}</span>
                                {% endfor %}
                            </div>
                            {% else %}
                            {{ form.family_history(class="form-control form-control-lg",
                            placeholder=note.family_history) }}
                            {% endif %}
                        </div>
                        <div class="form-group">
                            {{ form.diagnostic_notes.label(class="form-control-label") }}

                            {% if form.diagnostic_notes.errors %}
                            {{ form.diagnostic_notes(class="form-control form-control-lg
                            is-invalid") }}
                            <div class="invalid-feedback">
                                {% for error in form.diagnostic_notes.errors %}
                                <span>{{ error }}</span>
                                {% endfor %}
                            </div>
                            {% else %}
                            {{ form.diagnostic_notes(class="form-control form-control-lg",
                            placeholder=note.diagnostic_notes) }}
                            {% endif %}
                        </div>
                    </fieldset>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-success">Send message</button>
                </div>
            </form>
        </div>
    </div>
</div>
{%- endmacro%}

<div class="container emp-profile">
    <div class="card-container">
        <form method="POST">
            <div class="row">
                <div class="col-md-4">
                    <div class="profile-img">
                        <img src="https://merck-user-images.s3.us-east-2.amazonaws.com/{{patient.image}}" alt="" />
                        <div class="file btn btn-lg btn-primary">
                            Change Photo
                            <input type="file" name="file" />
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="profile-head">
                        <h5>
                            {{ patient.first_name }} {{ patient.last_name }}
                        </h5>
                        <h6>
                            Tested for {{ patient.purpose }}
                        </h6>
                        <p class="proile-rating">Number of Days Observed : <span>15</span></p>
                        <ul class="nav nav-tabs" id="myTab" role="tablist">
                            <li class="nav-item">
                                <a class="nav-link" id="home-tab" data-target="home"
                                    href="{{ url_for('profile_home', patient_id=patient.patient_id) }}" role="tab"
                                    aria-controls="home" aria-selected="false">About</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" id="profile-tab" data-target="profile"
                                    href="{{ url_for('profile_timeline', patient_id=patient.patient_id) }}" role="tab"
                                    aria-controls="profile" aria-selected="false">Surveys</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link active" id="notes-tab" data-target="notes"
                                    href="{{ url_for('profile_notes', patient_id=patient.patient_id) }}" role="tab"
                                    aria-controls="notes" aria-selected="true">Notes</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" id="notes-tab" data-target="notes"
                                    href="{{ url_for('patient_fitbit_data', patient_id=patient.patient_id) }}"
                                    role="tab" aria-controls="notes" aria-selected="false">Fitbit Data</a>
                            </li>
                            <li class="nav-item ms-auto">
                                <button type="button" class="btn btn-primary" data-bs-toggle="modal"
                                    data-bs-target="#exampleModal">
                                    New Note
                                </button>
                            </li>
                        </ul>
                    </div>
                </div>
                <div class="col-md-2">
                    <a class="btn btn-primary" href="{{ url_for('patients') }}" role="button">Close Profile</a>
                </div>
            </div>
            <div class="row">
                <div class="col-md-4">
                    <div class="profile-work">
                        <p>DATA LINKS</p>
                        <a href="">Visualizations</a><br />
                        <a href="">Analysis</a><br />
                        <a href="">Videos</a>
                    </div>
                </div>
                <div class="col-md-8 vertical-scrollable mt-0">
                    <div class="tab-content profile-tab" id="myTabContent">
                        <div class="tab-pane fade show active" id="notes" role="tabpanel" aria-labelledby="notes-tab">
                            {% with messages = get_flashed_messages(with_categories=true) %}
                            {% if messages %}
                            {% for category, message in messages %}
                            <div class="alert alert-{{ category }} mt-0">
                                {{ message }}
                            </div>
                            {% endfor %}
                            {% endif %}
                            {% endwith %}
                            {% block more_content %}{% endblock %}

                            {% if notes %}
                            {% for note in notes %}
                            <div class="card mt-2 border-5 pt-0 active pb-0 px-3">
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-10">
                                            <h4 class="card-title">
                                                <h5>{{calendar.day_name[note.input_date.weekday()]}} -
                                                    {{note.input_date.day}}
                                                    {{calendar.month_name[note.input_date.month]}},
                                                    {{note.input_date.year}}</h5>
                                            </h4>
                                        </div>
                                        <div class="col-2 align-self-center">
                                            <button type="button" class="btn btn-primary" data-bs-toggle="modal"
                                                data-bs-target="#viewModal{{note.input_date.date()}}">
                                                View
                                            </button>
                                            {{render_modal(note)}}
                                        </div>
                                        <div class="col">
                                            <h6 class="card-subtitle mb-2 text-muted">
                                                <p class="card-text text-muted small "> <img
                                                        src="https://img.icons8.com/metro/26/000000/star.png"
                                                        class="mr-1 " width="19" height="19" id="star"> <span
                                                        class="vl mr-2 ml-0"></span>
                                                    Created by <span class="font-weight-bold">Dr. Phil</span>
                                                    on {{note.input_date.day}}
                                                    {{calendar.month_name[note.input_date.month]}},
                                                    {{note.input_date.year}}
                                                </p>
                                            </h6>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                            {% else %}
                            <div class="alert alert-danger mt-0">
                                No data to display
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </form>
    </div>
</div>

<!-- Modal -->
<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-scrollable" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="esurveyModalTitle">{{calendar.day_name[today.weekday()]}} -
                    {{today.day}}
                    {{calendar.month_name[today.month]}},
                    {{today.year}}</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form action="" method="POST">
                <div class="modal-body">
                    {{ form.hidden_tag() }}
                    <fieldset>
                        <div class="form-group">
                            {{ form.username.label(class="form-control-label") }}

                            {% if form.username.errors %}
                            {{ form.username(class="form-control form-control-lg is-invalid") }}
                            <div class="invalid-feedback">
                                {% for error in form.username.errors %}
                                <span>{{ error }}</span>
                                {% endfor %}
                            </div>
                            {% else %}
                            {{ form.username(class="form-control form-control-lg") }}
                            {% endif %}
                        </div>
                        <div class="form-group">
                            {{ form.input_date.label(class="form-control-label") }}

                            {% if form.input_date.errors %}
                            {{ form.input_date(class="form-control form-control-lg is-invalid")
                            }}
                            <div class="invalid-feedback">
                                {% for error in form.input_date.errors %}
                                <span>{{ error }}</span>
                                {% endfor %}
                            </div>
                            {% else %}
                            {{ form.input_date(class="form-control form-control-lg") }}
                            {% endif %}
                        </div>
                        <div class="form-group">
                            {{ form.family_history.label(class="form-control-label") }}

                            {% if form.family_history.errors %}
                            {{ form.family_history(class="form-control form-control-lg
                            is-invalid") }}
                            <div class="invalid-feedback">
                                {% for error in form.family_history.errors %}
                                <span>{{ error }}</span>
                                {% endfor %}
                            </div>
                            {% else %}
                            {{ form.family_history(class="form-control form-control-lg") }}
                            {% endif %}
                        </div>
                        <div class="form-group">
                            {{ form.diagnostic_notes.label(class="form-control-label") }}

                            {% if form.diagnostic_notes.errors %}
                            {{ form.diagnostic_notes(class="form-control form-control-lg
                            is-invalid") }}
                            <div class="invalid-feedback">
                                {% for error in form.diagnostic_notes.errors %}
                                <span>{{ error }}</span>
                                {% endfor %}
                            </div>
                            {% else %}
                            {{ form.diagnostic_notes(class="form-control form-control-lg") }}
                            {% endif %}
                        </div>
                    </fieldset>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-success">Send message</button>
                </div>
            </form>
        </div>
    </div>
</div>

</html>

{% endblock %}